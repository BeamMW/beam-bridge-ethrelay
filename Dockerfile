FROM node:14-alpine

# copy source code & define working directory
ENV SOURCE_DIR=/home/ethrelay/source/
RUN  mkdir -p $SOURCE_DIR

COPY ./ $SOURCE_DIR

WORKDIR $SOURCE_DIR

# Define volume
RUN  mkdir -p /home/ethrelay/data/


ENV BEAM_WALLET_API_PORT=11011
ENV BEAM_WALLET_API_HOST=api
ENV BEAM_WALLET_API_HTPP_PATH="/api/wallet"
ENV BEAM_PIPE_APP_PATH="/home/beam/wallet/pipe_app.wasm"
ENV BEAM_PIPE_CID=f289e408b42d3e1f0d3411f827a8b312826ce2387698d63a8e6466ad11e9ffec
ENV BEAM_BLOCK_CREATION_PERIOD=15000
ENV BEAM_MIN_CONFIRMATIONS=1

ENV ETH_HTTP_PROVIDER="http://geth:8543"
ENV ETH_WEBSOCKET_PROVIDER="ws://geth:8546"
ENV ETH_PIPE_CONTRACT_ADDRESS="0xd6B18EC3711e777F029B17283aa4ea6557493E35"
ENV ETH_RELAYER_ADDRESS="0xfc63595a89699a742502e03d4021be5dbfc2dd38"
ENV ETH_TOKEN_CONTRACT="0xe0a55f2c08125b7dac7132e02b043ED30359034E"
ENV ETH_RELAYER_PRIVATE_KEY="0x4f36098269a51be36bfa7680923d3a79d4310510fb6428374b4dacf80654674b"
ENV ETH_MIN_CONFRIMATIONS=1
ENV ETH_PIPE_PUSH_REMOTE_GAS_LIMIT=150000
ENV ETH_HARDFORK='london'
ENV ETH_CHAIN='goerli'

ENV ETH2BEAM_DB_PATH="/home/ethrelay/data/eth2beam.db"
ENV BEAM2ETH_DB_PATH="/home/ethrelay/data/beam2eth.db"
ENV ETH_PIPE_CONTRACT_ABI=EthERC20Pipe.json

ENV RELAYER_SCRIPT="beam2eth_relay.js"

RUN apk add --no-cache git
RUN npm install --save

CMD node $SOURCE_DIR/$RELAYER_SCRIPT
